#!/bin/bash
# MySync daily script
# Last updated: February 27th, 2016
# See readme.txt for details
#
###############################################################################################
################ DO NOT EDIT BELOW THIS LINE UNLESS YOU KNOW WHAT YOU'RE DOING ################
###############################################################################################

if [[ "$@" == "" ]]
    then
	echo "something bad happened... no arguments passed... exiting."
	exit
fi

unset PATH
RM=/bin/rm
MV=/bin/mv
CP=/bin/cp
TOUCH=/usr/bin/touch
RSYNC=/usr/bin/rsync
LOCATION=$1
EXCLUDES=backup_exclude.txt
DEBUG="$3"

########################## daily backups ###################################
# Delete the oldest snapshot, if it exists, move others recursively
if [ -d $LOCATION/daily/daily.6 ]
   then
        $RM -rf $LOCATION/weekly/weekly.0/
        $MV $LOCATION/hourly/hourly.6 $LOCATION/weekly/weekly.0
fi
if [ -d $LOCATION/daily/daily.5 ]
    then
        $MV $LOCATION/daily/daily.5 $LOCATION/daily/daily.6
fi
if [ -d $LOCATION/daily/daily.4 ]
    then
        $MV $LOCATION/daily/daily.4 $LOCATION/daily/daily.5
fi
if [ -d $LOCATION/daily/daily.3 ]
    then
        $MV $LOCATION/daily/daily.3 $LOCATION/daily/daily.4
fi
if [ -d $LOCATION/daily/daily.2 ]
    then
	$MV $LOCATION/daily/daily.2 $LOCATION/daily/daily.3
fi
if [ -d $LOCATION/daily/daily.1 ]
    then
	$MV $LOCATION/daily/daily.1 $LOCATION/daily/daily.2
fi
if [ -d $LOCATION/daily/daily.0 ]
    then
	$MV $LOCATION/daily/daily.0 $LOCATION/daily/daily.1
	$MKDIR -p "$LOCATION/daily/daily.0"
	$PAX -rwl "$LOCATION/hourly/hourly.6" "$LOCATION/daily/daily.0"
fi

echo "Daily log rotation completed!"  >> mysync.log
